<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>CASA 1848+283 J1849+3024 - ManOxWiki</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1561.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 13.0px Arial; color: #000000; -webkit-text-stroke: #000000; min-height: 15.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 4.0px; font: 12.0px Arial; color: #000000; -webkit-text-stroke: #000000; background-color: #81bbf2; min-height: 14.0px}
    p.p14 {margin: 0.0px 0.0px 12.0px 0.0px; line-height: 15.0px; font: 12.0px Arial; color: #000000; -webkit-text-stroke: #000000}
    p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 12.0px Courier; color: #000000; -webkit-text-stroke: #000000; background-color: #f3f5f7}
    p.p18 {margin: 0.0px 0.0px 12.0px 0.0px; line-height: 15.0px; font: 12.0px Arial; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 12.0px Courier; color: #000000; -webkit-text-stroke: #000000; background-color: #f3f5f7; min-height: 14.0px}
    p.p22 {margin: 0.0px 0.0px 12.0px 0.0px; line-height: 15.0px; font: 12.0px Courier; color: #000000; -webkit-text-stroke: #000000}
    p.p23 {margin: 0.0px 0.0px 12.0px 0.0px; line-height: 15.0px; font: 12.0px Arial; color: #0044b3; -webkit-text-stroke: #0044b3}
    p.p24 {margin: 0.0px 0.0px 10.2px 0.0px; line-height: 15.0px; font: 10.2px Arial; color: #808080; -webkit-text-stroke: #808080}
    li.li2 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: right; line-height: 15.0px; font: 12.0px Arial; color: #808080; -webkit-text-stroke: #0044b3}
    li.li3 {margin: 0.0px 0.0px 5.0px 0.0px; line-height: 15.0px; font: 13.0px Arial; color: #0044b3; -webkit-text-stroke: #0044b3}
    li.li4 {margin: 0.0px 2.0px 0.0px 0.0px; line-height: 15.0px; font: 13.0px Arial; color: #000000; -webkit-text-stroke: #000000; background-color: #ffffff}
    li.li5 {margin: 0.0px 2.0px 0.0px 0.0px; line-height: 15.0px; font: 13.0px Arial; color: #000000; -webkit-text-stroke: #000000; background-color: #81bbf2}
    li.li7 {margin: 0.0px 6.0px 2.0px 0.0px; line-height: 15.0px; font: 13.0px Arial; color: #0044b3; -webkit-text-stroke: #0044b3}
    li.li8 {margin: 0.0px 6.0px 2.0px 0.0px; line-height: 15.0px; font: 13.0px Arial; color: #0044b3; -webkit-text-stroke: #0044b3; background-color: #ffffff}
    li.li9 {margin: 0.0px 6.0px 2.0px 0.0px; line-height: 13.0px; font: 11.0px Times; color: #000000; -webkit-text-stroke: #000000; background-color: #ffffff}
    li.li10 {margin: 0.0px 6.0px 2.0px 0.0px; line-height: 13.0px; font: 11.0px Times; color: #808080; -webkit-text-stroke: #808080; background-color: #ffffff}
    li.li11 {margin: 0.0px 6.0px 2.0px 0.0px; line-height: 13.0px; font: 11.0px 'Helvetica Neue'; color: #000000; -webkit-text-stroke: #000000}
    li.li16 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 12.0px Arial; color: #0044b3; -webkit-text-stroke: #0044b3; background-color: #ffffff}
    li.li17 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.0px; font: 12.0px Arial; color: #0044b3; -webkit-text-stroke: #0044b3}
    li.li25 {margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; line-height: 15.0px; font: 12.0px Arial; color: #0044b3; -webkit-text-stroke: #0044b3}
    span.s1 {font-kerning: none}
    span.s2 {background-color: #e7e7e7; -webkit-text-stroke: 0px #000000}
    span.s3 {text-decoration: underline ; font-kerning: none; -webkit-text-stroke: 0px #808080}
    span.s4 {font-kerning: none; color: #000000; background-color: #e7e7e7; -webkit-text-stroke: 0px #000000}
    span.s5 {text-decoration: underline ; font-kerning: none; color: #0044b3; -webkit-text-stroke: 0px #0044b3}
    span.s6 {font: 13.0px Arial; text-decoration: underline ; font-kerning: none; color: #0044b3}
    span.s7 {-webkit-text-stroke: 0px #000000}
    span.s8 {font-kerning: none; background-color: #81bbf2}
    span.s9 {background-color: #ffffff; -webkit-text-stroke: 0px #000000}
    span.s10 {text-decoration: underline ; font-kerning: none}
    span.s11 {text-decoration: underline ; font-kerning: none; color: #0044b3}
    span.s12 {font: 11.0px 'Helvetica Neue'; -webkit-text-stroke: 0px #000000}
    span.s13 {font: 11.0px 'Helvetica Neue'; font-kerning: none}
    span.s14 {font-kerning: none; background-color: #ffffff}
    span.s15 {font: 13.0px Arial; font-kerning: none; background-color: #ffffff}
    span.s16 {font: 24.0px Arial; font-kerning: none}
    span.s17 {font: 12.0px Arial; text-decoration: underline ; font-kerning: none; color: #0044b3; -webkit-text-stroke: 0px #0044b3}
    span.s18 {font: 12.0px Courier; font-kerning: none; background-color: #ffffff}
    span.s19 {text-decoration: underline ; font-kerning: none; background-color: #ffffff}
    span.s20 {font-kerning: none; color: #000000; background-color: #ffffff; -webkit-text-stroke: 0px #000000}
    span.s21 {font: 12.0px Arial; font-kerning: none; background-color: #ffffff}
    span.s22 {font: 12.0px Arial; text-decoration: underline ; font-kerning: none; color: #0044b3; background-color: transparent}
    span.s23 {font-kerning: none; color: #6c7680; -webkit-text-stroke: 0px #6c7680}
    span.s24 {font-kerning: none; color: #0044b3; -webkit-text-stroke: 0px #0044b3}
    ol.ol1 {list-style-type: decimal}
    ul.ul1 {list-style-type: disc}
  </style>
</head>
<body>
<p class="p1"><span class="s1"></span><br></p>
<ul class="ul1">
  <li class="li2"><span class="s2"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/JackRadcliffe"><span class="s3">JackRadcliffe</span></a></span><span class="s4"> <a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/UserPreferences"><span class="s5">UserPreferences</span></a></span></li>
</ul>
<ul class="ul1">
  <li class="li3"><span class="s2"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/RecentChanges"><span class="s6">RecentChanges</span></a></span></li>
  <li class="li3"><span class="s2"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/FrontPage"><span class="s6">FrontPage</span></a></span></li>
  <li class="li3"><span class="s2"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/EVN_Continuum"><span class="s6">EVN Continuum</span></a></span></li>
  <li class="li3"><span class="s2"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_Basic_EVN"><span class="s6">CASA Basic EVN</span></a></span></li>
</ul>
<ul class="ul1">
  <li class="li4"><span class="s7"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/FrontPage"><span class="s1">FrontPage</span></a></span></li>
  <li class="li4"><span class="s7"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/RecentChanges"><span class="s1">RecentChanges</span></a></span></li>
  <li class="li4"><span class="s7"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/FindPage"><span class="s1">FindPage</span></a></span></li>
  <li class="li4"><span class="s7"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/HelpContents"><span class="s1">HelpContents</span></a></span></li>
  <li class="li5"><span class="s7"><b></b><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024"><span class="s8"><b>CASA 1848+283 J1849+3024</b></span></a></span></li>
</ul>
<p class="p6"><span class="s1"></span><br></p>
<ul class="ul1">
  <li class="li7"><span class="s9"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=edit"><span class="s10">Edit</span></a></span></li>
  <li class="li7"><span class="s9"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=diff"><span class="s10">Show Changes</span></a></span></li>
  <li class="li7"><span class="s9"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=info"><span class="s10">Get Info</span></a></span></li>
  <li class="li8"><span class="s7"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=subscribe"><span class="s11">Subscribe</span></a></span></li>
  <li class="li9"><span class="s12"></span><span class="s13"><span class="Apple-converted-space">        </span></span><span class="s1">More Actions:Show Raw Text</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Show Print View</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Delete Cache</span></li>
  <li class="li10"><span class="s7"></span><span class="s1">--------</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Attachments</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Check Spelling</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Show Like Pages</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Show Local Site Map</span></li>
  <li class="li10"><span class="s7"></span><span class="s1">--------</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Rename Page</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Delete Page</span></li>
  <li class="li11"><span class="s9"></span><span class="s14"><span class="Apple-converted-space">    </span></span><span class="s15"><span class="Apple-converted-space"> </span></span></li>
</ul>
<h1 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 28.8px; font: 24.0px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=fullsearch&amp;value=%27CASA+1848%2B283+J1849%2B3024%27&amp;literal=1&amp;case=1&amp;context=180"><b>CASA 1848+283 J1849+3024</b><span class="s16"><b></b></span></a></span></h1>
<h2 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 23.0px; font: 19.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Calibration and imaging of J1849+3024</b></span></h2>
<p class="p14"><span class="s14">This page expects that you have used <a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_Basic_EVN"><span class="s17">CASA_Basic_EVN</span></a> to get as far as applying the Tsys/gain curve, initial delay and bandpass corrections to all sources and split out 1848+283_J1849+3024.ms (and also to become familiar with the basics of CASA). A new MS contains just a 'data' column. The previous </span><span class="s18">applycal</span><span class="s14"> made a copy of the data with calibration applied, writing a 'corrected' column into the MS and </span><span class="s18">split</span><span class="s14"> then took just that column and wrote new data sets, where this becomes a 'data' column.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">(If you don't have a good version of 1848+283_J1849+3024.ms (remove any bad versions), get 1848+283_J1849+3024.ms.tgz and extract it using </span><span class="s18">tar -zxvf 1848+283_J1849+3024.ms.tgz</span><span class="s14">.)<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">You also need <a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=AttachFile&amp;do=get&amp;target=NME_J1849.py"><span class="s17">NME_J1849.py</span></a> .<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">1848+283_J1849+3024.ms contains phase-ref 1848+283 and target J1849+3024. You should have 1848+283_J1849+3024.ms.listobs made at the end of <a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_Basic_EVN"><span class="s17">CASA_Basic_EVN</span></a> which shows the interleaving of the target and phase-ref.<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">13:23:20.0 - 13:24:20.0<span class="Apple-converted-space">    </span>38<span class="Apple-converted-space">      </span>1 1848+283 <span class="Apple-converted-space">                </span>18720<span class="Apple-converted-space">  </span>[0,1,2,3,4,5,6,7]<span class="Apple-converted-space">  </span>[2, 2, 2, 2, 2, 2, 2, 2]<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">13:25:00.0 - 13:26:00.0<span class="Apple-converted-space">    </span>39<span class="Apple-converted-space">      </span>0 J1849+3024 <span class="Apple-converted-space">              </span>18720<span class="Apple-converted-space">  </span>[0,1,2,3,4,5,6,7]<span class="Apple-converted-space">  </span>[2, 2, 2, 2, 2, 2, 2, 2]<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">13:26:40.0 - 13:27:40.0<span class="Apple-converted-space">    </span>40<span class="Apple-converted-space">      </span>1 1848+283 <span class="Apple-converted-space">                </span>18720<span class="Apple-converted-space">  </span>[0,1,2,3,4,5,6,7]<span class="Apple-converted-space">  </span>[2, 2, 2, 2, 2, 2, 2, 2]<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">13:28:20.0 - 13:29:20.0<span class="Apple-converted-space">    </span>41<span class="Apple-converted-space">      </span>0 J1849+3024 <span class="Apple-converted-space">              </span>15840<span class="Apple-converted-space">  </span>[0,1,2,3,4,5,6,7]<span class="Apple-converted-space">  </span>[2, 2, 2, 2, 2, 2, 2, 2]<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">13:30:00.0 - 13:31:00.0<span class="Apple-converted-space">    </span>42<span class="Apple-converted-space">      </span>1 1848+283 <span class="Apple-converted-space">                </span>15840<span class="Apple-converted-space">  </span>[0,1,2,3,4,5,6,7]<span class="Apple-converted-space">  </span>[2, 2, 2, 2, 2, 2, 2, 2]<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">...</span></p>
<p class="p14"><span class="s14">Look at the script in a text editor. Each step contains one or a few tasks which perform a step in calibration or imaging. It is not completely automatic because it expects interactive imaging, and you need to inspect some of the plots to check or make decisions. The source names and some other parameters are set as variables so the script could be used as a template for other similar data reduction. The </span><span class="s18">taskname(parameter=value)</span><span class="s14"> way of running a task automatically sets all unspecificed parameters to default. Use </span><span class="s18">inp task</span><span class="s14"> or </span><span class="s18">help task</span><span class="s14"> at the CASA prompt to check before running a task.<span class="Apple-converted-space"> </span></span></p>
<ol class="ol1">
  <li class="li16"><span class="s7"></span><span class="s10">Calibration and imaging of J1849+3024</span></li>
  <ol class="ol1">
    <li class="li17"><span class="s9"></span><span class="s19">Initial inspection of data (step 1)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
    <li class="li16"><span class="s7"></span><span class="s10">Calibration using the phase-reference source</span></li>
    <ol class="ol1">
      <li class="li17"><span class="s9"></span><span class="s19">Time-dependent delay and phase calibration (step 2)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
    </ol>
    <li class="li16"><span class="s7"></span><span class="s10">Apply phase solutions and image phase-ref(step 3)</span></li>
    <ol class="ol1">
      <li class="li17"><span class="s9"></span><span class="s19">Check for remaining bad data (step 4)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Time-dependent amplitude calibration (step 5)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Apply amplitude and phase solutions to the phase-ref (step 6)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Clean the calibrated phase-ref (step 7)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Uncalibrated target image (step 8)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Apply all calibration to the target (step 9)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
    </ol>
    <li class="li16"><span class="s7"></span><span class="s10">Imaging and self-calibration of the target</span></li>
    <ol class="ol1">
      <li class="li17"><span class="s9"></span><span class="s19">Split out target 2 and image (step 10)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Self-calibrate target phase only and apply (step 11)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Image phase-self-calibrated target (step 12)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Self-calibrate target amplitude and phase and apply (step 13)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
      <li class="li17"><span class="s9"></span><span class="s19">Image the amplitude and phase self-calibrated target (step 14)</span><span class="s20"><span class="Apple-converted-space"> </span></span></li>
    </ol>
  </ol>
</ol>
<p class="p18"><span class="s1"></span><br></p>
<h3 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.7px; font: 15.6px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Initial inspection of data (step 1)</b></span></h3>
<p class="p15"><span class="s1"># In CASA</span></p>
<p class="p20"><span class="s1"></span><br></p>
<p class="p15"><span class="s1">mysteps=[1]</span></p>
<p class="p15"><span class="s1">execfile('NME_J1849.py')</span></p>
<p class="p14"><span class="s14">Page through the plots. The phase-ref is in red, target in black. The phase offsets for both sources follow a similar pattern per baseline and correlation, so the phase-reference solutions should also correct the target OK. Note that JB misses every other pair of scans. </span><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024.png" alt="CASA_1848+283_J1849+3024.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h3 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.7px; font: 15.6px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Calibration using the phase-reference source</b></span></h3>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Time-dependent delay and phase calibration (step 2)</b></span></h4>
<p class="p14"><span class="s14">First, we solve for residual delay errors for each scan on the phase-ref.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Set </span><span class="s18">mysteps=[2]</span><span class="s14"> and repeat as above. Look at the plot of the solutions. </span><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_1.png" alt="CASA_1848+283_J1849+3024_1.png"></span><span class="s14"> tool-b Normally, the bandpass and phase calibrators are different sources; since in this case they are the same, the corrections are very small.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">This step also solves for phase as a function of time, averaging all channels (with the new delay corrections applied). There are a number of considerations in chosing the solution interval; here, the phase errors do not change massively in a minute but the S/N is high. So using 30s, half the scan length, means that all the data will be used in interpolating over the target.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024_2.png" alt="CASA_1848+283_J1849+3024_2.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Each colour is a different spw. The phase corrections change more rapidly with time for the antennas on the longest baselines but if you zoom in you can see that the solutions are coherent, not just noise.<span class="Apple-converted-space"> </span></span></p>
<h3 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.7px; font: 15.6px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Apply phase solutions and image phase-ref(step 3)</b></span></h3>
<p class="p14"><span class="s14">In VLBI, even calibration sources are often resolved, and making an image is also a useful check. First, the delay and phase corrections are applied to the MS to make a corrected column using </span><span class="s18">applycal</span><span class="s14">.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">The task </span><span class="s18">clean</span><span class="s14"> (which always used the corrected column if it is present) is used for imaging. It makes a Fourier Transform (FT) of the visibility data to make a 'dirty image', and also makes an FT of the <i>uv</i> tracks to make a 'dirty beam'. This is very messy, with many sidelobes, and when we talk about the resolution or synthesised beam, this is an idealised Gaussian fit to the FWHM of the central beam peak. The pixel size of these images is a free parameter, but you should make it such that there are at least 3, usually 5 pixels across the synthesised beam.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s18">clean</span><span class="s14"> then goes through many cycles in which it identifies the brightest pixels and then takes 10% (default) of the flux density at each of these pixels and records the value/position in a Clean Components (CC) table. </span><span class="s18">clean</span><span class="s14"> calculates the sidelobe response for each CC and subtracts that and the CC from the dirty map. This is known as a 'minor cycle'. After a certain number of minor cycles, the collected CC are FT'd and subtracted from the visibility data, which are then re-FT'd back to make a new dirty image, which will have less bright emission and fewer sidelobes. This is known as a 'major cycle'. These cycles are continued until the final dirty image (the 'residual image') is indistinguishable from noise. All the CC are then restored to the visibility data (without their sidelobes!), the result is FT'd and this is convolved with the restoring beam to make the 'clean image'.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">You can set a mask to restrict the area of the map in which </span><span class="s18">clean</span><span class="s14"> looks for CC, based on inspection and/or prior knowledge of the source.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">You can roughly predict the synthesised beam size </span><span class="s18">theta_B</span><span class="s14"> by looking at the antenna positions, </span><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_Basic_EVN.png" alt="CASA_Basic_EVN.png"></span><span class="s14"> The max. baseline </span><span class="s18">max_B</span><span class="s14"> is roughly 10,000 km, and we are observing at 5 GHz, so (all in metres):<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">max_B = 10000000.</span></p>
<p class="p15"><span class="s1">wavelength = 0.06</span></p>
<p class="p15"><span class="s1">theta_B= 3600.*degrees(wavelength/max_B) <span class="Apple-converted-space">  </span># convert from radians to degrees and thence to arcsec</span></p>
<p class="p15"><span class="s1">theta_B</span></p>
<p class="p14"><span class="s14">You can just cut-and-paste this into CASA which returns </span><span class="s18">theta_B</span><span class="s14"> ~0.001 arcsec = 1 mas. 0.0002 arcsec is thus a good pixel size. The overall image size is determined by how large you think the source is (here we assume that a phase-reference is compact) or the field of view, and must be even (a power of 2 or multiples of 2,3,5,7 are fast).<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Here is an explanation of the relevant parameters:<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">os.system('rm -rf '+phscal2+'_phasecal.clean*') <span class="Apple-converted-space">  </span># delete any failed attempts</span></p>
<p class="p15"><span class="s1">clean(vis=phscal2+'_'+target2+'.ms',</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>imagename=phscal2+'_phasecal.clean',</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>field=phscal2,</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>imsize=256,<span class="Apple-converted-space">                        </span># Image size ~50 mas should be big enough</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>cell='0.0002arcsec', <span class="Apple-converted-space">              </span># Pixel size calculated above</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>niter=100, <span class="Apple-converted-space">                        </span># Total number of clean iterations<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>cyclefactor=1, <span class="Apple-converted-space">                    </span># Speed up clean with a higher ratio minor:major cycles, OK for a compact source.</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>interactive=T, <span class="Apple-converted-space">                    </span># Set/change mask manually</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>npercycle=50,<span class="Apple-converted-space">                      </span># Return partly-cleaned image for inspection/changing mask every 50 iterations</span></p>
<p class="p15"><span class="s1"><span class="Apple-converted-space">      </span>usescratch=T)<span class="Apple-converted-space">                      </span># Write model to MS for use in calibration</span></p>
<p class="p14"><span class="s14">Run </span><span class="s18">mystep=[3]</span><span class="s14"> - we will demonstrate how to set the mask.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">If you make a mess, you can type</span><span class="s18">execfile('clean.last')</span><span class="s14"> to restore the inputs and change what you need; don't forget to delete the failed attempt first. Or just cut and paste from above, if you just messed up masking.<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1"># In CASA</span></p>
<p class="p15"><span class="s1">ls -d *_phasecal.clean*</span></p>
<p class="p14"><span class="s14">which should show<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">1848+283_phasecal.clean.flux/<span class="Apple-converted-space">          </span># Primary beam response</span></p>
<p class="p15"><span class="s1">1848+283_phasecal.clean.image/ <span class="Apple-converted-space">        </span># Clean image<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1">1848+283_phasecal.clean.mask/<span class="Apple-converted-space">          </span># The mask you used</span></p>
<p class="p15"><span class="s1">1848+283_phasecal.clean.model/ <span class="Apple-converted-space">        </span># The CC</span></p>
<p class="p15"><span class="s1">1848+283_phasecal.clean.psf/ <span class="Apple-converted-space">          </span># Dirty (synthesised) beam</span></p>
<p class="p15"><span class="s1">1848+283_phasecal.clean.residual/<span class="Apple-converted-space">      </span># Residual before restoring CC</span></p>
<p class="p14"><span class="s14">Inspect the clean image:<span class="Apple-converted-space"> </span></span></p>
<p class="p15"><span class="s1"># In CASA</span></p>
<p class="p15"><span class="s1">viewer('1848+283_phasecal.clean.image')</span></p>
<p class="p14"><span class="s14">You can change the display interactively, load the dirty beam etc.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">The script also reports the image rms, peak and S/N. I got<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Peak 1.292, rms 0.040, S/N 32<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">but you may get different numbers depending on how you set the mask and how many iterations you did, but they should be similar.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_3.png" alt="CASA_1848+283_J1849+3024_3.png"></span><span class="s14"> </span><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_4.png" alt="CASA_1848+283_J1849+3024_4.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Check for remaining bad data (step 4)</b></span></h4>
<p class="p14"><span class="s14">If this was a data set no-one had looked at before, you would inspect the data manually, not in the script, in order to page through all the baselines and identify bad data, but it is not the best use of your time here, so all the flagging was already applied. Just run </span><span class="s18">mysteps=[4]</span><span class="s14"> to check. This plot shows all the baselines to EF on one plot: </span><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_5.png" alt="CASA_1848+283_J1849+3024_5.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Time-dependent amplitude calibration (step 5)</b></span></h4>
<p class="p14"><span class="s14">Whilst the application of Tsys (early in the data reduction) should scale the amplitudes, it is subject to instrumental error and the previous plot shows at least one antenna has suspiciously high amplitudes. Run </span><span class="s18">mysteps=[5]</span><span class="s14">. </span><span class="s18">solnorm=T</span><span class="s14"> means, estimate the corrections with one solution per solution interval, antenna, polarization. Then form the mean product of all the amplitude solutions and divide each solution by this. This means that the relative variations of the solutions with time etc. are corrected, but the product of the gains overall is unity so an image made from the data will still have the same flux scale. CASA gain solutions are divided into the data, so a high gain will correct a high amplitude, as seen for the second antenna.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_6.png" alt="CASA_1848+283_J1849+3024_6.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Apply amplitude and phase solutions to the phase-ref (step 6)</b></span></h4>
<p class="p14"><span class="s14">Run </span><span class="s18">mysteps=[6]</span><span class="s14"> to apply the solutions and inspect the corrected data.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_7.png" alt="CASA_1848+283_J1849+3024_7.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">This plot shows only baselines to EF. There is now less scatter but there are two groups of baselines with quite distinct flux densities. However, this could be due to the source being resolved.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_8.png" alt="CASA_1848+283_J1849+3024_8.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Plotting amplitude against uv distance (for all baselines) shows that indeed there is more flux on short baselines than on long baselines.<span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Clean the calibrated phase-ref (step 7)</b></span></h4>
<p class="p14"><span class="s14">As before, </span><span class="s18">mystep=[7]</span><span class="s14"> needs you to set a mask interactively. After cleaning, I got<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Peak 1.529, rms 0.001, S/N 1599<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">- a big improvement!<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_9.png" alt="CASA_1848+283_J1849+3024_9.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Uncalibrated target image (step 8)</b></span></h4>
<p class="p14"><span class="s14">So far, we have applied the Tsys and gain-elevation curve corrections to the amplitudes for all data, and we have applied the initial delay and bandpass corrections to all data. This phase-ref has also had more calibration applied but we have not yet applied any time-dependent calibration of phase to the target.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Run </span><span class="s18">mystep=[8]</span><span class="s14"> - this does not do any cleaning because one look at the dirty image shows that it is useless.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_10.png" alt="CASA_1848+283_J1849+3024_10.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Apply all calibration to the target (step 9)</b></span></h4>
<p class="p22"><span class="s21">Run </span><span class="s14">mystep=[9]</span><span class="s21"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">The phase reference solutions are now interpolated over the target data. Since the data are taken close in time and the sources are close together on the sky, we assume that the atmospheric distortions are similar. In the plot you made above, in 'Check for remaining bad data (step 4)' you see that one antenna only records every other pair of target - phase-ref scans. This is JB, and in order to allow for the longer gaps, we handle it separately (this may not always be necessary in future versions of CASA).<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">In the first </span><span class="s18">applycal</span><span class="s14"> all the antennas except JB are corrected. </span><span class="s18">smoothcal</span><span class="s14"> then is used to smooth the JB solutions over an interval longer than the gaps between its pairs of scans, for each table, and the smoothed table is applied to JB only. Parameter </span><span class="s18">interp=['nearest','nearest','nearest']</span><span class="s14"> has three values because we are applying 3 calibration tables. (The default is </span><span class="s18">linear</span><span class="s14"> for linear interpolation but this can miss data if the final phase-ref scan is missing and extrapolation is needed instead).<span class="Apple-converted-space"> </span></span></p>
<h3 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.7px; font: 15.6px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Imaging and self-calibration of the target</b></span></h3>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Split out target 2 and image (step 10)</b></span></h4>
<p class="p14"><span class="s14">Run </span><span class="s18">mystep=[10]</span><span class="s14"> and clean interactively. From now on, the input MS is J1849+3024.ms<span class="Apple-converted-space"> </span></span></p>
<p class="p23"><span class="s19"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=AttachFile&amp;rename=_image_scaJ1849%2B3024_image-cal0.png">Upload new attachment "_image_scaJ1849+3024_image-cal0.png"</a></span><span class="s20"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">I got Peak 0.211, rms 0.010, S/N 21 This is not as low noise as the final phase-ref image because the separation on the sky and in time is enough for there to be small differences in atmosphere. These are corrected by self-calibration. This is the same principle as we used above using the phase reference source to derive corrections, except that in this case we only apply the corrections to the same source, the target itself. Also, in the very first round of calibration, the model is the CC made from the image we just made after applying the phase-reference solutions, i.e. it is already a good approximation to the actual structure and position of the target (without depending on a catalogue value).<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">This map shows dominantly asymmetric artefacts (positive on one side of the source, negative on the other) which are due to remaining phase errors.<span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Self-calibrate target phase only and apply (step 11)</b></span></h4>
<p class="p14"><span class="s14">Later in the week we will discuss in more detail why a solution interval of 10 sec is used. Empirically, you see that only a few solutions fail, and it is short enough to give accurate corrections. The plot below shows that there are quite large residual corrections for some antennas, but they have structure, not just noise.<span class="Apple-converted-space"> </span></span></p>
<p class="p22"><span class="s21">Run </span><span class="s14">mysteps=[11]</span><span class="s21"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_11.png" alt="CASA_1848+283_J1849+3024_11.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Image phase-self-calibrated target (step 12)</b></span></h4>
<p class="p14"><span class="s14">Run </span><span class="s18">mysteps=[12]</span><span class="s14"> with interactive cleaning. I got<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Peak 0.256, rms 0.001, S/N 249<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">so, a nice improvement.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_12.png" alt="CASA_1848+283_J1849+3024_12.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">This step plots the corrected data and the model uv amplitudes, colourised by baseline. You can see that although the data have more scatter, the model does represent the data quite well, i.e. the CC have been located where there is real emission, not sidelobes, and the image has not missed bright emission.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_13.png" alt="CASA_1848+283_J1849+3024_13.png"></span><span class="s14"> </span><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_14.png" alt="CASA_1848+283_J1849+3024_14.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Self-calibrate target amplitude and phase and apply (step 13)</b></span></h4>
<p class="p22"><span class="s21">Run </span><span class="s14">mysteps=[13]</span><span class="s21">.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">The amplitude errors change more slowly than phase errors and as we are applying the phase solutions we can average for longer in time to get better S/N. The solutions are mostly close to unity with no very wild ones.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_15.png" alt="CASA_1848+283_J1849+3024_15.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<h4 style="margin: 0.0px 0.0px 0.0px 0.0px; line-height: 15.8px; font: 13.2px Arial; color: #000000; -webkit-text-stroke: #000000"><span class="s14"><b>Image the amplitude and phase self-calibrated target (step 14)</b></span></h4>
<p class="p14"><span class="s14">Run </span><span class="s18">mysteps=[14]</span><span class="s14"> with interactive cleaning. I got<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Peak 0.254, rms 0.001, S/N 311<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">so the noise is as good as for the phase-ref.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_16.png" alt="CASA_1848+283_J1849+3024_16.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">The differences between the uvplots of these averaged data before and after the final calibration are hard to see, but enough to make the improvement in S/N.<span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_17.png" alt="CASA_1848+283_J1849+3024_17.png"></span><span class="s14"> </span><span class="s1"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/CASA_1848+283_J1849+3024_18.png" alt="CASA_1848+283_J1849+3024_18.png"></span><span class="s14"><span class="Apple-converted-space"> </span></span></p>
<p class="p14"><span class="s14">Congralulation! You have finished imaging J1849+3024<span class="Apple-converted-space"> </span></span></p>
<p class="p24"><span class="s14">last edited 2016-04-29 14:06:47 by AnitaRichards</span></p>
<ul class="ul1">
  <li class="li7"><span class="s9"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=edit"><span class="s10">Edit</span></a></span></li>
  <li class="li7"><span class="s9"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=diff"><span class="s10">Show Changes</span></a></span></li>
  <li class="li7"><span class="s9"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=info"><span class="s10">Get Info</span></a></span></li>
  <li class="li8"><span class="s7"><a href="http://jbcamail.jb.man.ac.uk/DARA_Newton_wiki/CASA_1848+283_J1849+3024?action=subscribe"><span class="s11">Subscribe</span></a></span></li>
  <li class="li9"><span class="s12"></span><span class="s13"><span class="Apple-converted-space">        </span></span><span class="s1">More Actions:Show Raw Text</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Show Print View</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Delete Cache</span></li>
  <li class="li10"><span class="s7"></span><span class="s1">--------</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Attachments</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Check Spelling</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Show Like Pages</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Show Local Site Map</span></li>
  <li class="li10"><span class="s7"></span><span class="s1">--------</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Rename Page</span></li>
  <li class="li9"><span class="s7"></span><span class="s1">Delete Page</span></li>
  <li class="li11"><span class="s9"></span><span class="s14"><span class="Apple-converted-space">    </span></span><span class="s15"><span class="Apple-converted-space"> </span></span></li>
</ul>
<ul class="ul1">
  <li class="li25"><span class="s7"><a href="http://moinmoin.wikiwikiweb.de/"><span class="s22">MoinMoin Powered</span></a></span><span class="s23"> <a href="http://www.python.org/"><span class="s5">Python Powered</span></a> <a href="http://validator.w3.org/check?uri=referer"><span class="s24"><img src="CASA_1848+283_J1849+3024-ManOxWiki_files/valid-html401.png" alt="valid-html401.png"></span></a><span class="Apple-converted-space"> </span></span></li>
</ul>
</body>
</html>
